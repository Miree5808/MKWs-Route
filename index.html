<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Route Note</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #202124; color: #e8eaed; padding: 20px; max-width: 600px; margin: 0 auto; }
        h1 { text-align: center; font-size: 1.5rem; margin-bottom: 20px; }
        
        .search-box { background: #303134; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        
        /* ラベルに番号をつけて手順を明確化 */
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #8ab4f8; }
        .step-badge { background: #8ab4f8; color: #202124; padding: 2px 6px; border-radius: 4px; margin-right: 5px; font-size: 0.8em; }

        select { width: 100%; padding: 12px; margin-bottom: 20px; background: #202124; color: white; border: 1px solid #5f6368; border-radius: 4px; font-size: 16px; }
        select:disabled { background: #3c4043; color: #9aa0a6; cursor: not-allowed; }

        #result-area { display: none; background: #3c4043; padding: 20px; border-radius: 8px; border-left: 5px solid #8ab4f8; animation: fadeIn 0.3s ease; }
        .note-title { font-weight:bold; margin-bottom:10px; color: #8ab4f8; border-bottom: 1px solid #5f6368; padding-bottom: 5px;}
        .note-content { white-space: pre-wrap; line-height: 1.6; }
        
        .loading { text-align: center; color: #fbbc04; margin-top: 50px;}
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <body background="bg_map.webp">
        
    <h1>道 Note</h1>

    <div id="loading-msg" class="loading">データ読み込み中...</div>

    <div class="search-box" id="main-ui" style="display:none;">
        
        <label><span class="step-badge">1</span>START</label>
        <select id="start-select" onchange="updateEndOptions()">
            <option value="">選択してください</option>
        </select>

        <label><span class="step-badge">2</span>GOAL</label>
        <select id="end-select" onchange="findRoute()" disabled>
            <option value="">先にSTARTを選んでください</option>
        </select>
    </div>

    <div id="result-area">
        <div class="note-title">NOTE</div>
        <div id="note-text" class="note-content"></div>
    </div>

    <script>
        // ▼▼▼ あなたのスプレッドシートURLを設定しました ▼▼▼
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRGCuHHt7237RMl1ib0ZCfhczvmp0Sz7oWoJ0QrBaZgYqpLBJjBgOgiKJGUBhJX9E-Jg3Hew1LKq4rZ/pub?output=csv";
        // ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲

        let routeData = [];
        const startSelect = document.getElementById('start-select');
        const endSelect = document.getElementById('end-select');
        const resultArea = document.getElementById('result-area');

        // データ読み込み
        window.onload = function() {
            Papa.parse(SHEET_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    routeData = results.data;
                    initStartBox(); // ★まずはSTARTリストを作る
                    document.getElementById('loading-msg').style.display = 'none';
                    document.getElementById('main-ui').style.display = 'block';
                },
                error: function(err) {
                    alert("読み込み失敗：インターネット接続を確認してください");
                    console.error(err);
                }
            });
        };

        // 1. STARTの選択肢を作る関数
        function initStartBox() {
            // Start列の重複を除去してリスト化
            const startPoints = new Set(routeData.map(d => d.start).filter(s => s));
            
            // リストに追加
            startPoints.forEach(point => {
                const opt = document.createElement('option');
                opt.value = opt.text = point;
                startSelect.add(opt);
            });
        }

        // 2. STARTが選ばれた時に動く関数（GOALの中身を書き換える）
        function updateEndOptions() {
            const selectedStart = startSelect.value;
            
            // Goalをリセット
            endSelect.innerHTML = '<option value="">選択してください</option>';
            endSelect.disabled = true;
            resultArea.style.display = 'none';

            if (!selectedStart) return;

            // データの中から「選ばれたStart」から出発する行だけを探す
            // その行の「end」の値だけを集める
            const validEnds = routeData
                .filter(d => d.start === selectedStart)
                .map(d => d.end);

            if (validEnds.length > 0) {
                // 行ける場所（End）を追加
                validEnds.forEach(end => {
                    const opt = document.createElement('option');
                    opt.value = opt.text = end;
                    endSelect.add(opt);
                });
                endSelect.disabled = false; // 有効化
            } else {
                const opt = document.createElement('option');
                opt.text = "行き止まり / データなし";
                endSelect.add(opt);
            }
        }

        // 3. GOALを選んだらメモを表示する関数
        function findRoute() {
            const sv = startSelect.value; // Startの値
            const ev = endSelect.value;   // Goalの値
            
            if (!sv || !ev) {
                resultArea.style.display = 'none';
                return;
            }

            const found = routeData.find(d => d.start === sv && d.end === ev);
            
            if (found) {
                document.getElementById('note-text').textContent = found.note;
                resultArea.style.display = 'block';
            }
        }
    </script>
</body>
</html>



