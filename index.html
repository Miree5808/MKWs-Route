<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Route Note (Goal First)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #202124; color: #e8eaed; padding: 20px; max-width: 600px; margin: 0 auto; }
        h1 { text-align: center; font-size: 1.5rem; margin-bottom: 20px; }
        
        .search-box { background: #303134; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        
        /* é †ç•ªã‚’ã‚ã‹ã‚Šã‚„ã™ãã™ã‚‹ãŸã‚ã«ãƒ©ãƒ™ãƒ«ã«ç•ªå·é¢¨ã®è£…é£¾ */
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #8ab4f8; }
        .step-badge { background: #8ab4f8; color: #202124; padding: 2px 6px; border-radius: 4px; margin-right: 5px; font-size: 0.8em; }

        select { width: 100%; padding: 12px; margin-bottom: 20px; background: #202124; color: white; border: 1px solid #5f6368; border-radius: 4px; font-size: 16px; }
        select:disabled { background: #3c4043; color: #9aa0a6; cursor: not-allowed; }

        #result-area { display: none; background: #3c4043; padding: 20px; border-radius: 8px; border-left: 5px solid #8ab4f8; animation: fadeIn 0.3s ease; }
        .note-title { font-weight:bold; margin-bottom:10px; color: #8ab4f8; border-bottom: 1px solid #5f6368; padding-bottom: 5px;}
        .note-content { white-space: pre-wrap; line-height: 1.6; }
        
        .loading { text-align: center; color: #fbbc04; margin-top: 50px;}
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <h1>ğŸ® é€†å¼•ããƒ«ãƒ¼ãƒˆæ”»ç•¥</h1>

    <div id="loading-msg" class="loading">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</div>

    <div class="search-box" id="main-ui" style="display:none;">
        
        <label><span class="step-badge">1</span>GOAL</label>
        <select id="end-select" onchange="updateStartOptions()">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
        </select>

        <label><span class="step-badge">2</span>START</label>
        <select id="start-select" onchange="findRoute()" disabled>
            <option value="">å…ˆã«GOALã‚’é¸ã‚“ã§ãã ã•ã„</option>
        </select>
    </div>

    <div id="result-area">
        <div class="note-title">ğŸ“ æ”»ç•¥ãƒ¡ãƒ¢</div>
        <div id="note-text" class="note-content"></div>
    </div>

    <script>
        // â–¼â–¼â–¼ ã“ã“ã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‚’è²¼ã£ã¦ãã ã•ã„ â–¼â–¼â–¼
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRGCuHHt7237RMl1ib0ZCfhczvmp0Sz7oWoJ0QrBaZgYqpLBJjBgOgiKJGUBhJX9E-Jg3Hew1LKq4rZ/pub?output=csv"; 
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        let routeData = [];
        const startSelect = document.getElementById('start-select');
        const endSelect = document.getElementById('end-select');
        const resultArea = document.getElementById('result-area');

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        window.onload = function() {
            Papa.parse(SHEET_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    routeData = results.data;
                    initGoalBox(); // â˜…ã¾ãšã¯GOALãƒªã‚¹ãƒˆã‚’ä½œã‚‹
                    document.getElementById('loading-msg').style.display = 'none';
                    document.getElementById('main-ui').style.display = 'block';
                },
                error: function(err) {
                    alert("èª­ã¿è¾¼ã¿å¤±æ•—ï¼šURLã‚’ç¢ºèªã—ã¦ãã ã•ã„");
                }
            });
        };

        // 1. GOALã®é¸æŠè‚¢ã‚’ä½œã‚‹é–¢æ•°
        function initGoalBox() {
            // Endã®åˆ—ã«ã‚ã‚‹é‡è¤‡ã—ãªã„åå‰ã ã‘ã‚’é›†ã‚ã‚‹
            const endPoints = new Set(routeData.map(d => d.end).filter(s => s));
            
            endPoints.forEach(point => {
                const opt = document.createElement('option');
                opt.value = opt.text = point;
                endSelect.add(opt);
            });
        }

        // 2. GOALãŒé¸ã°ã‚ŒãŸæ™‚ã«å‹•ãé–¢æ•°ï¼ˆSTARTã®ä¸­èº«ã‚’æ›¸ãæ›ãˆã‚‹ï¼‰
        function updateStartOptions() {
            const selectedEnd = endSelect.value;
            
            // Startã‚’ãƒªã‚»ãƒƒãƒˆ
            startSelect.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
            startSelect.disabled = true;
            resultArea.style.display = 'none';

            if (!selectedEnd) return;

            // ãƒ‡ãƒ¼ã‚¿ã®ä¸­ã‹ã‚‰ã€Œé¸ã°ã‚ŒãŸGoalã€ã¸å‘ã‹ã†è¡Œã ã‘ã‚’æ¢ã™
            // ãã®è¡Œã®ã€Œstartã€ã®å€¤ã ã‘ã‚’é›†ã‚ã‚‹
            const validStarts = routeData
                .filter(d => d.end === selectedEnd)
                .map(d => d.start);

            if (validStarts.length > 0) {
                // å‡ºç™ºã§ãã‚‹å ´æ‰€ã‚’è¿½åŠ 
                validStarts.forEach(start => {
                    const opt = document.createElement('option');
                    opt.value = opt.text = start;
                    startSelect.add(opt);
                });
                startSelect.disabled = false; // æœ‰åŠ¹åŒ–
            } else {
                const opt = document.createElement('option');
                opt.text = "åˆ°é”ãƒ«ãƒ¼ãƒˆãªã—";
                startSelect.add(opt);
            }
        }

        // 3. STARTã‚’é¸ã‚“ã ã‚‰ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function findRoute() {
            const sv = startSelect.value;
            const ev = endSelect.value; // Goalã®å€¤ã‚’å–å¾—
            
            if (!sv || !ev) {
                resultArea.style.display = 'none';
                return;
            }

            const found = routeData.find(d => d.start === sv && d.end === ev);
            
            if (found) {
                document.getElementById('note-text').textContent = found.note;
                resultArea.style.display = 'block';
            }
        }
    </script>
</body>

</html>
